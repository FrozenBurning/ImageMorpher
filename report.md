# 数值分析第一次大作业 报告


## 问题分析

### 问题分解
#### 必做任务
必做任务要求将给定尺寸为$512 \times 512$以图片中心像素点进行旋转扭曲。该任务可以被分解为以下三步：
- 图片读取与预处理
- 计算新图中扭曲点在原图中的坐标位置
- 依照原图中的浮点坐标位置对像素值进行插值
- 显示扭曲后的图像

#### 选做任务
选做任务要求利用薄板样条插值（Thin Plate Spline），在给定的人脸图像之间，利用预先给出的68个人脸特征控制点进行变形，达到人脸融合的效果。该任务可以被分解为以下几步：
- 图片预处理与特征点读取
- 求解原图到目标图的TPS坐标变换矩阵
- 利用坐标变换矩阵对目标图中所有像素点进行坐标变换
- 在原图中用变换得到的坐标插值出像素值
- 显示变形后的图像


### 需求分析
#### 必做任务
依照上面的问题分解，必做任务中的坐标转换已经预先给出，因此只需要实现插值函数。按照要求，本次将实现最近邻、双线性、双三次三种插值方法。

#### 选做任务
选做任务是一个更为复杂的应用场景，因此所需要考虑的细节也就更多。建立在必做任务中所实现的插值方法基础上，本任务中需要实现TPS变形的求解器。同时针对TPS全局变形的特点，变形后的图片有可能与原图尺寸相差很远，若继续用原图尺寸显示，则会在图片四周产生大量黑色像素，有碍观感，因此需要实现边缘裁剪等功能。


## 方案设计
### 基本原理
#### 图像扭曲变形
（扭曲变形的函数关系）
- 最近邻
最近邻插值对于给定的插值节点，选择距离其最近的像素点的像素值作为其自身的像素值。
- 双线性
双线性插值对于给定的插值节点，选择距离其最近的四个像素点，分别从x轴和y轴两个方向进行线性插值，并将两次线性插值的结果加权后作为最终结果。
- 双三次
双三次插值不同于前面的两种方法，

#### 图像畸变矫正



#### TPS网格变形
TPS具体原理 矩阵关系、图片与控制点的区分

由于TPS属于全局变形，虽然人脸的68个控制点会集中在图片中一个小区域，但是经过能量最小化处理后，图片的边界可能会缩入原图尺寸之内，导致边缘部分出现很多黑色像素。这样的情况在变形的两张图片之间尺寸差别很大的时候会十分明显。图片裁剪的原理也就基于这样的现象，对于变换后的图片从四个边界向内部归并搜索，遇到黑像素则缩小边界。迭代结束后去最大的边界作为裁剪后的尺寸。

### UI设计与向导
#### 界面概览


#### 使用方法

## 结果分析
### 图像处理效果

### 误差分析
#### 插值方法

#### TPS变形

## 总结与体会 